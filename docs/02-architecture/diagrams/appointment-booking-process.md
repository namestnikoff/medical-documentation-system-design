# Сквозной процесс: Запись пациента на приём

## Обзор

Данный документ описывает полный процесс записи пациента на приём к врачу, включая авторизацию, выбор врача, проверку доступности и создание записи.

## Диаграммы

- **BPMN диаграмма:** `patient_appointment_booking.bpmn` (бизнес-процесс)
- **BPMN изображение:** `patient_appointment_booking.png` (визуализация)
- **Sequence диаграммы PlantUML:** 
  - `patient-authentication-detailed.puml` (авторизация)
  - `appointment-booking-detailed.puml` (бронирование)

## Бизнес-процесс (BPMN)

Процесс состоит из следующих основных этапов:

1. **Авторизация пациента** — пациент входит в систему с использованием email и пароля
2. **Выбор врача и времени** — после успешной авторизации пациент выбирает врача и удобное время
3. **Проверка доступности слота** — система проверяет, свободно ли выбранное время
4. **Создание записи** — если слот доступен, система создаёт запись
5. **Публикация события** — отправка события в Kafka для интеграции и уведомлений
6. **Уведомление пациента** — система отправляет подтверждение записи пациенту

### Альтернативные сценарии

- **Авторизация не пройдена** — пациенту предлагается повторить ввод учётных данных
- **Слот недоступен** — пациенту предлагается выбрать другое время

## Технические детали (Sequence Diagrams)

### 1. Авторизация пациента

**Файл диаграммы:** `patient-authentication-detailed.puml`

**Основные шаги:**
- Пациент вводит email и пароль
- API Gateway проверяет JWT токен
- Auth Service проверяет учётные данные в базе
- При успехе генерируются токены (accessToken, refreshToken)

**Коды ответов:**
- `200 OK` — успешная авторизация
- `401 Unauthorized` — неверный email или пароль

**Безопасность:**
- Пароли хранятся в виде хешей (bcrypt)
- JWT токены имеют ограниченный срок действия
- Все запросы передаются по HTTPS

### 2. Бронирование записи

**Файл диаграммы:** `appointment-booking-detailed.puml`

**Основные шаги:**
- Пациент выбирает врача и время
- API Gateway валидирует JWT токен
- Doctor Service проверяет существование врача
- Appointment Service проверяет доступность слота
- При успехе создаётся запись и публикуется событие в Kafka

**Коды ответов:**
- `201 Created` — запись успешно создана
- `401 Unauthorized` — недействительный токен
- `404 Not Found` — врач не найден
- `409 Conflict` — временной слот уже занят

**События Kafka:**
- `AppointmentScheduled` — публикуется после создания записи

## Участники системы

- **Пациент** — пользователь, записывающийся на приём
- **Веб-приложение (Front)** — клиентский интерфейс
- **API Gateway** — точка входа для всех запросов
- **Auth Service** — управление аутентификацией и авторизацией
- **Doctor Service** — управление данными врачей
- **Appointment Service** — управление записями на приём
- **База данных** — хранение данных
- **Kafka** — шина событий для асинхронного обмена

## Интеграционные точки

- REST API для синхронного взаимодействия
- Kafka для асинхронных уведомлений и интеграции с другими сервисами
- JWT для безопасной передачи данных между компонентами
