# Интеграционный профиль

## Обзор

Обмен данными в системе строится на едином брокере сообщений — Apache Kafka, дополняющем REST и GraphQL интерфейсы для синхронных запросов.

## REST и gRPC API


- REST API — основной, универсальный способ синхронного взаимодействия между сервисами и внешними системами. Он широко поддерживается и хорошо подходит для большинства задач CRUD.

- gRPC — современный, высокопроизводительный протокол, использующий HTTP/2 и Protocol Buffers. Предназначен для внутреннего взаимодействия между микросервисами с высокими требованиями к скорости и типизации.

- Рекомендуется применять gRPC только при наличии чётких бизнес-задач, требующих высокой производительности, компактной сериализации и строгих контрактов, а также при готовности команды к дополнительной сложности в разработке и эксплуатации.

- Если в проекте нет таких требований, лучше ограничиться REST, что упростит поддержку и развитие системы.


- Чётко определённые эндпоинты для CRUD операций с пациентами, приёмами и документами.
- Описаны с помощью OpenAPI (Swagger), что облегчает поддержку и тестирование.

## GraphQL API

- Обеспечивает гибкий агрегационный доступ к данным.
- Поддержка запросов с фильтрацией и подписок на обновления данных.

## Kafka как единый Event Bus

- Все события бизнес-процессов (например, DocumentCreated, DocumentSigned) публикуются в Kafka.
- Это обеспечивает надежность, масштабируемость и упорядоченность обработки данных.
- Интеграция с Debezium читает WAL PostgreSQL и публикует изменения для последующей синхронизации с OpenSearch.
- Асинхронные микросервисы подписываются на нужные топики, обеспечивая реактивную обработку.

## Масштабируемость и устойчивость

- Используется масштабируемый кластер Kafka.
- Мониторинг потоков, отложенная обработка неудачных сообщений.
- Распределённый характер интеграций позволяет обеспечить отказоустойчивость.

## Диаграмма потоков данных

![Диаграмма интеграции](http://www.plantuml.com/plantuml/proxy?cache=no&src=https://raw.githubusercontent.com/namestnikoff/medical-documentation-system-design/main/docs/04-integration/diagrams/integration-flows.puml)

[Исходный код диаграммы](diagrams/integration-flows.puml)
