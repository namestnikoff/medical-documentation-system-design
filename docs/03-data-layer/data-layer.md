# Слой данных

## Обзор

Данный раздел описывает логическую модель данных и ключевые бизнес-сценарии, отражая жизненный цикл документов и связанные процессы.

## ER-диаграмма

![Диаграмма сущностей слоя данных](http://www.plantuml.com/plantuml/proxy?cache=no&src=https://raw.githubusercontent.com/namestnikoff/medical-documentation-system-design/main/docs/03-data-layer/diagrams/entities.puml)

[Исходный код диаграммы](diagrams/entities.puml)

## Основные сущности и связи

| Сущность           | Описание                   | Ключевые атрибуты                        | Связи                     |
|--------------------|----------------------------|-----------------------------------------|---------------------------|
| Пациент            | Личные данные пациента      | id, ФИО, дата рождения, номер полиса    | Прием, МедДокумент        |
| Врач               | Информация о враче          | id, ФИО, специализация                   | Прием, МедДокумент        |
| Прием              | Информация о приеме         | id, дата, тип приема                     | Пациент, Врач, Услуга     |
| Услуга             | Медицинские услуги          | id, название, код, стоимость             | Прием                     |
| МедДокумент        | Электронные медицинские документы | id, тип, дата создания, статус         | Прием, Подпись, СобытиеОбмена |
| Подпись            | Мета-информация об ЭП       | id, doc_id, подписант, дата подписания  | МедДокумент               |
| СобытиеОбмена      | Фиксация событий интеграции | id, тип события, doc_id, дата, статус   | МедДокумент               |

## Основные бизнес-сценарии

1. Регистрация приёма пациента, создание и подписание МедДокументов.
2. Передача документов в федеральное хранилище, фиксируемая через СобытиеОбмена.
3. Поиск и агрегирование информации через GraphQL API с GIN-индексацией.
4. Аудит изменений документов, ведение версионности и журнала изменений.

## Дополнительно

- Для полнотекстового поиска используются GIN-индексы PostgreSQL, при высоких нагрузках рассматривается интеграция с OpenSearch.
- Все процессы и связи максимально соответствуют требованиям законодательства РФ по медданным.
- Архитектура обеспечена ролями доступа и защитой данных на уровне базы и приложений.

---
